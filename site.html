<html>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<script src="https://unpkg.com/axios/dist/axios.min.js">
  const axios = require('axios');
</script>


<body>
  <h1>Movie Database</h1>

  <p>Enter a movie to search.</p>


  <!-- <form onsubmit="searchTitle()">
  <label for="mName">Movie name:</label>
  <input type="text" id="mName" name="mName">
  <input type="submit" value="Submit"><br><br>

  <label for="dName">Director name:</label>
  <input type="text" id="dName" name="dName">
  <input type="submit" value="Submit"><br><br>
</form>  -->
  <label for="nMovie">Movie</label>
  <input type="text" id="nMovie" onchange="searchTitle()">

  <input type="button" onclick="searchTitle()" value="Submit"><br>

  <label for="mDetails">Results:</label><br>
  <textarea id="mDetails" name="mDetails" rows="20" cols="100"></textarea>

  <div id="suggestions">
  </div>

  <script>
    function searchTitle() {
      let title = document.getElementById('nMovie').value
      // localhost:8080/imdb/movies?title=+title"
      // axios.get("http://localhost:8080/imdb/movies?t=" + title).then(function (response) {
      axios.get("https://www.omdbapi.com/?apikey=95b1aff&t=" + document.getElementById('nMovie').value).then(function (
        response) {
        // handle success
        console.log(response);
        document.getElementById('mDetails').innerHTML = '';
        for (var key in response.data) {
          var value = response.data[key];
          document.getElementById('mDetails').append(key + ': ' + String(value) + '\n');
        }
        document.getElementById('mDetails').append('\n\n\n')
      })
      getSuggestions();
    }


    function getSuggestions() {
      var title = String(document.getElementById('nMovie').value);
      title = title.toLowerCase();
      console.log('piss');
      if (location.hostname === "localhost" || location.hostname === "127.0.0.1") {
        var url = "http://localhost:8080/imdb/movies/suggestions?t=" + title
      } else {
        url = "http://184.146.136.208:8080/imdb/movies/suggestions?t=" + title
      }
      axios.get(url).then(function (response) {
        console.log(response);
        var data = response.data;
        var container = document.getElementById('suggestions');
        // console.log('before ' + container.childNodes.length);
        // for (let i = 0; i < container.childNodes.length; i++) {
        //   console.log(container.childNodes[i].innerHTML);
        // }
        while (container.firstChild != null) {
          container.removeChild(container.firstChild);
        }
        // console.log('after ' + container.childNodes.length);
        for (let i = 0; i < data.length; i++) {
          const label = document.createElement('label');
          // label.id = 'sug_' + i;
          console.log('id: ' + data[i][1]);
          label.id = data[i][1];
          label.innerHTML = String(data[i][0]);
          label.addEventListener("click", function () {
            searchSuggestion(label.id);
          });
          let br = document.createElement('br');
          let image = document.createElement('img');
          image.src = data[i][2];
          image.id = data[i][1];
          image.alt = 'No image';
          image.style = "width:200px;height:300px;"
          image.addEventListener("click", function () {
            searchSuggestion(image.id);
          })
          container.appendChild(label);
          container.appendChild(br);
          container.appendChild(image)
          container.appendChild(document.createElement('br'))
          container.appendChild(document.createElement('br'))
        }
      })
    }

    function searchSuggestion(id) {
      // let choice = document.getElementById(id).innerHTML;
      // localhost:8080/imdb/movies?title=+title"
      // axios.get("http://localhost:8080/imdb/movies?t=" + title).then(function (response) {
      axios.get("https://www.omdbapi.com/?apikey=95b1aff&i=" + id).then(function (response) {
        // handle success
        console.log(response);
        document.getElementById('mDetails').innerHTML = '';
        for (var key in response.data) {
          var value = response.data[key];
          document.getElementById('mDetails').append(key + ': ' + String(value) + '\n');
        }
        document.getElementById('mDetails').append('\n\n\n')
      })
      topFunction();

    }

    function topFunction() {
      console.log('top');
      document.body.scrollTop = 0; // For Safari
      document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
    }
  </script>

</body>

</html>